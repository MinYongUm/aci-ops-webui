<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACI Ops WebUI</title>
    
    <!-- Bootstrap CSS - ë°˜ì‘í˜• ì›¹ ë””ìì¸ì„ ìœ„í•œ CSS í”„ë ˆì„ì›Œí¬ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* ============================================
           ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì •
           ============================================ */
        body { background-color: #f8f9fa; color: #333; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ - ê° ì„¹ì…˜ì„ ê°ì‹¸ëŠ” ë°•ìŠ¤ */
        .card { 
            background-color: #fff; 
            border: 1px solid #dee2e6; 
            margin-bottom: 20px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .card-header { 
            background-color: #0d6efd; 
            color: #fff; 
            font-weight: bold; 
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-primary { background-color: #0d6efd; border-color: #0d6efd; }
        .btn-primary:hover { background-color: #0b5ed7; border-color: #0b5ed7; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ìŠ¤íƒ€ì¼ */
        .navbar { background-color: #212529; }
        .navbar-brand { color: #fff !important; font-weight: bold; }
        
        /* ìƒë‹¨ í†µê³„ ìˆ«ì ìŠ¤íƒ€ì¼ */
        .stat-number { font-size: 2rem; font-weight: bold; color: #0d6efd; }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table { color: #333; }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ - ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        .loading { display: none; }
        
        /* ============================================
           í† í´ë¡œì§€ ì‹œê°í™” ìŠ¤íƒ€ì¼
           ============================================ */
        .topology-container { padding: 20px; }
        
        /* Spine, Leaf ë ˆì´ì–´ - Flexboxë¡œ ì¤‘ì•™ ì •ë ¬ */
        .spine-layer, .leaf-layer { 
            display: flex; 
            justify-content: center; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin: 20px 0; 
        }
        
        /* ë…¸ë“œ ë°•ìŠ¤ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .node-box { 
            padding: 10px 15px; 
            border-radius: 8px; 
            text-align: center; 
            font-size: 12px;
            font-weight: bold;
            min-width: 100px;
        }
        
        /* ë…¸ë“œ ì¢…ë¥˜ë³„ ìƒ‰ìƒ */
        .spine-node { background-color: #6f42c1; color: #fff; }      /* ë³´ë¼ìƒ‰ - Spine */
        .leaf-node { background-color: #20c997; color: #fff; }       /* ì´ˆë¡ìƒ‰ - Leaf */
        .controller-node { background-color: #fd7e14; color: #fff; } /* ì£¼í™©ìƒ‰ - Controller */
        
        /* ë ˆì´ì–´ ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .layer-label { 
            text-align: center; 
            font-weight: bold; 
            color: #666; 
            margin: 10px 0;
            font-size: 14px;
        }
        
        /* ë ˆì´ì–´ ì‚¬ì´ ì—°ê²°ì„  */
        .topology-line {
            height: 3px;
            background: linear-gradient(90deg, #6f42c1, #20c997);
            margin: 15px 50px;
            border-radius: 2px;
        }
        
        /* ë…¸ë“œ ìƒíƒœ í‘œì‹œ - í…Œë‘ë¦¬ ìƒ‰ìƒìœ¼ë¡œ êµ¬ë¶„ */
        .node-status-up { border: 3px solid #198754; }   /* ì •ìƒ - ì´ˆë¡ í…Œë‘ë¦¬ */
        .node-status-down { border: 3px solid #dc3545; } /* ë‹¤ìš´ - ë¹¨ê°„ í…Œë‘ë¦¬ */
    </style>
</head>
<body>
    <!-- ============================================
         ë„¤ë¹„ê²Œì´ì…˜ ë°”
         - í˜ì´ì§€ ìƒë‹¨ ê³ ì • ë©”ë‰´
         - Refresh All ë²„íŠ¼ìœ¼ë¡œ ì „ì²´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
         ============================================ -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">ğŸ–¥ï¸ ACI Ops WebUI</a>
            <button class="btn btn-primary" onclick="loadAll()">ğŸ”„ Refresh All</button>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
    <div class="container">
        
        <!-- ============================================
             ë¡œë”© ìŠ¤í”¼ë„ˆ
             - ë°ì´í„° ë¡œë“œ ì¤‘ í‘œì‹œ
             - JavaScriptì—ì„œ display ì†ì„± ì œì–´
             ============================================ -->
        <div id="loading" class="loading text-center mb-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- ============================================
             ìƒë‹¨ ìš”ì•½ ì¹´ë“œ (Summary Row)
             - 4ê°œì˜ ì£¼ìš” ì§€í‘œë¥¼ í•œëˆˆì— í‘œì‹œ
             - Total Faults, Security Risks, Endpoints, Nodes
             ============================================ -->
        <div class="row mb-4">
            <!-- Total Faults ì¹´ë“œ -->
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6>Total Faults</h6>
                        <div class="stat-number" id="total-faults">-</div>
                    </div>
                </div>
            </div>
            <!-- Security Risks ì¹´ë“œ -->
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6>Security Risks</h6>
                        <div class="stat-number" id="security-risks">-</div>
                    </div>
                </div>
            </div>
            <!-- Total Endpoints ì¹´ë“œ -->
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6>Total Endpoints</h6>
                        <div class="stat-number" id="total-endpoints">-</div>
                    </div>
                </div>
            </div>
            <!-- Nodes Up ì¹´ë“œ -->
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6>Nodes Up</h6>
                        <div class="stat-number" id="nodes-up">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             ìƒì„¸ ì •ë³´ ì¹´ë“œ - ì²« ë²ˆì§¸ í–‰
             - Health Check: Fault ìƒíƒœ í‘œì‹œ
             - Policy Check: ë³´ì•ˆ ì •ì±… ê²€ì¦ ê²°ê³¼
             ============================================ -->
        <div class="row">
            <!-- Health Check ì¹´ë“œ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">ğŸ¥ Health Check</div>
                    <div class="card-body">
                        <div id="health-content">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Policy Check ì¹´ë“œ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">ğŸ”’ Policy Check</div>
                    <div class="card-body">
                        <div id="policy-content">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             ìƒì„¸ ì •ë³´ ì¹´ë“œ - ë‘ ë²ˆì§¸ í–‰
             - Interface Monitor: ì¸í„°í˜ì´ìŠ¤ ìƒíƒœ
             - Endpoint Tracker: Endpoint í†µê³„
             ============================================ -->
        <div class="row">
            <!-- Interface Monitor ì¹´ë“œ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">ğŸ”Œ Interface Monitor</div>
                    <div class="card-body">
                        <div id="interface-content">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Endpoint Tracker ì¹´ë“œ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">ğŸ“ Endpoint Tracker</div>
                    <div class="card-body">
                        <div id="endpoint-content">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             ìƒì„¸ ì •ë³´ ì¹´ë“œ - ì„¸ ë²ˆì§¸ í–‰
             - Audit Log: ì„¤ì • ë³€ê²½ ì´ë ¥
             - Capacity Report: ìš©ëŸ‰ ë¦¬í¬íŠ¸
             ============================================ -->
        <div class="row">
            <!-- Audit Log ì¹´ë“œ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">ğŸ“‹ Audit Log</div>
                    <div class="card-body">
                        <div id="audit-content">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Capacity Report ì¹´ë“œ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">ğŸ“Š Capacity Report</div>
                    <div class="card-body">
                        <div id="capacity-content">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             í† í´ë¡œì§€ ë·°ì–´ ì¹´ë“œ
             - ì „ì²´ ë„ˆë¹„ ì‚¬ìš© (col-12)
             - Spine-Leaf êµ¬ì¡° ì‹œê°í™”
             ============================================ -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">ğŸ—ºï¸ Topology Viewer</div>
                    <div class="card-body">
                        <div id="topology-content">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         JavaScript ì„¹ì…˜
         - API í˜¸ì¶œ ë° ë°ì´í„° ë Œë”ë§ ë¡œì§
         ============================================ -->
    <script>
        /**
         * ì „ì²´ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
         * - /api/all ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
         * - ëª¨ë“  ëª¨ë“ˆ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜´
         */
        async function loadAll() {
            // ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ
            document.getElementById('loading').style.display = 'block';
            
            try {
                // FastAPI ë°±ì—”ë“œì—ì„œ ì „ì²´ ë°ì´í„° ì¡°íšŒ
                const response = await fetch('/api/all');
                const data = await response.json();
                
                // ìƒë‹¨ Summary ì¹´ë“œ ì—…ë°ì´íŠ¸
                document.getElementById('total-faults').textContent = data.health.total_faults;
                document.getElementById('security-risks').textContent = data.policy.security_risks;
                document.getElementById('total-endpoints').textContent = data.endpoint.total;
                document.getElementById('nodes-up').textContent = data.health.nodes.up;
                
                // ê° ì„¹ì…˜ë³„ ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
                renderHealth(data.health);
                renderPolicy(data.policy);
                renderInterface(data.interface);
                renderEndpoint(data.endpoint);
                renderAudit(data.audit);
                renderCapacity(data.capacity);
                renderTopology(data.topology);
                
            } catch (error) {
                console.error('Error:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
            // ë¡œë”© ìŠ¤í”¼ë„ˆ ìˆ¨ê¹€
            document.getElementById('loading').style.display = 'none';
        }

        /**
         * Health Check ë°ì´í„° ë Œë”ë§
         * @param {Object} data - health API ì‘ë‹µ ë°ì´í„°
         */
        function renderHealth(data) {
            // Fault ì‹¬ê°ë„ë³„ Badge í‘œì‹œ
            let html = `
                <p><strong>Fault Summary:</strong></p>
                <div class="d-flex gap-2 flex-wrap mb-3">
                    <span class="badge bg-danger">Critical: ${data.severity.critical}</span>
                    <span class="badge bg-warning text-dark">Major: ${data.severity.major}</span>
                    <span class="badge bg-info">Minor: ${data.severity.minor}</span>
                    <span class="badge bg-secondary">Warning: ${data.severity.warning}</span>
                </div>
            `;
            
            // Critical & Major Fault ìƒì„¸ ëª©ë¡
            if (data.critical_major.length > 0) {
                html += `<p><strong>Critical & Major Faults:</strong></p><ul class="list-group">`;
                data.critical_major.forEach(f => {
                    // ì‹¬ê°ë„ì— ë”°ë¼ Badge ìƒ‰ìƒ ê²°ì •
                    const badgeClass = f.severity === 'CRITICAL' ? 'bg-danger' : 'bg-warning text-dark';
                    html += `<li class="list-group-item d-flex align-items-center gap-2">
                        <span class="badge ${badgeClass}">${f.severity}</span>
                        <small>${f.description}</small>
                    </li>`;
                });
                html += `</ul>`;
            }
            
            // DOMì— ë Œë”ë§
            document.getElementById('health-content').innerHTML = html;
        }

        /**
         * Policy Check ë°ì´í„° ë Œë”ë§
         * @param {Object} data - policy API ì‘ë‹µ ë°ì´í„°
         */
        function renderPolicy(data) {
            // Tenant, Contract, Filter ê°œìˆ˜ í‘œì‹œ
            let html = `
                <div class="d-flex gap-3 mb-3">
                    <span class="badge bg-primary">Tenants: ${data.total_tenants}</span>
                    <span class="badge bg-primary">Contracts: ${data.total_contracts}</span>
                    <span class="badge bg-primary">Filters: ${data.total_filters}</span>
                </div>
                <p><strong>Security Risks: <span class="text-danger">${data.security_risks}</span></strong></p>
            `;
            
            // ìœ„í—˜í•œ Contract ëª©ë¡ (ìµœëŒ€ 5ê°œ)
            if (data.risky_contracts.length > 0) {
                html += `<p><strong>Risky Contracts:</strong></p><ul class="list-group mb-2">`;
                data.risky_contracts.slice(0, 5).forEach(c => {
                    html += `<li class="list-group-item list-group-item-warning"><small>[${c.tenant}] ${c.name}</small></li>`;
                });
                html += `</ul>`;
            }
            
            document.getElementById('policy-content').innerHTML = html;
        }

        /**
         * Interface Monitor ë°ì´í„° ë Œë”ë§
         * @param {Object} data - interface API ì‘ë‹µ ë°ì´í„°
         */
        function renderInterface(data) {
            // ì¸í„°í˜ì´ìŠ¤ Up/Down ê°œìˆ˜ í‘œì‹œ
            let html = `
                <div class="d-flex gap-3 mb-3">
                    <span class="badge bg-primary">Total: ${data.total}</span>
                    <span class="badge bg-success">Up: ${data.up}</span>
                    <span class="badge bg-danger">Down: ${data.down}</span>
                </div>
                <p><strong>Down Reasons:</strong></p>
                <table class="table table-sm table-bordered">
                    <thead class="table-light"><tr><th>Reason</th><th>Count</th></tr></thead>
                    <tbody>
            `;
            
            // Down ì›ì¸ë³„ ì¹´ìš´íŠ¸ í…Œì´ë¸”
            data.down_reasons.slice(0, 5).forEach(r => {
                html += `<tr><td>${r.reason}</td><td><span class="badge bg-secondary">${r.count}</span></td></tr>`;
            });
            html += `</tbody></table>`;
            
            document.getElementById('interface-content').innerHTML = html;
        }

        /**
         * Endpoint Tracker ë°ì´í„° ë Œë”ë§
         * @param {Object} data - endpoint API ì‘ë‹µ ë°ì´í„°
         */
        function renderEndpoint(data) {
            // Tenantë³„ Endpoint ê°œìˆ˜ í…Œì´ë¸”
            let html = `
                <p>Total Endpoints: <strong class="text-primary">${data.total}</strong></p>
                <table class="table table-sm table-bordered">
                    <thead class="table-light"><tr><th>Tenant</th><th>Count</th></tr></thead>
                    <tbody>
            `;
            
            data.by_tenant.forEach(t => {
                html += `<tr><td>${t.tenant}</td><td><span class="badge bg-primary">${t.count}</span></td></tr>`;
            });
            html += `</tbody></table>`;
            
            document.getElementById('endpoint-content').innerHTML = html;
        }

        /**
         * Audit Log ë°ì´í„° ë Œë”ë§
         * @param {Object} data - audit API ì‘ë‹µ ë°ì´í„°
         */
        function renderAudit(data) {
            // ë³€ê²½ ìœ í˜•ë³„ Badge í‘œì‹œ
            let html = `
                <p>Recent Changes: <strong>${data.total}</strong></p>
                <div class="d-flex gap-2 mb-3">
                    <span class="badge bg-success">Creation: ${data.actions.creation}</span>
                    <span class="badge bg-warning text-dark">Modification: ${data.actions.modification}</span>
                    <span class="badge bg-danger">Deletion: ${data.actions.deletion}</span>
                </div>
                <p><strong>By User:</strong></p>
                <ul class="list-group">
            `;
            
            // ì‚¬ìš©ìë³„ ë³€ê²½ íšŸìˆ˜
            data.by_user.forEach(u => {
                html += `<li class="list-group-item d-flex justify-content-between">${u.user}<span class="badge bg-primary">${u.count}</span></li>`;
            });
            html += `</ul>`;
            
            document.getElementById('audit-content').innerHTML = html;
        }

        /**
         * Capacity Report ë°ì´í„° ë Œë”ë§
         * @param {Object} data - capacity API ì‘ë‹µ ë°ì´í„°
         */
        function renderCapacity(data) {
            // High Usage ë…¸ë“œ ê°œìˆ˜ í‘œì‹œ
            let html = `<p>High Usage Nodes (>=80%): <strong class="${data.high_usage_count > 0 ? 'text-danger' : 'text-success'}">${data.high_usage_count}</strong></p>`;
            
            // ì •ìƒ ìƒíƒœë©´ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            if (data.high_usage_count === 0) {
                html += `<div class="alert alert-success">âœ… All nodes within normal capacity.</div>`;
            }
            
            // TCAM ì‚¬ìš©ëŸ‰ í…Œì´ë¸”
            html += `
                <table class="table table-sm table-bordered">
                    <thead class="table-light"><tr><th>Node</th><th>Used</th><th>Capacity</th><th>Usage</th></tr></thead>
                    <tbody>
            `;
            data.tcam.slice(0, 8).forEach(t => {
                // ì‚¬ìš©ë¥ ì— ë”°ë¼ Badge ìƒ‰ìƒ ê²°ì • (80% ì´ìƒ: ë¹¨ê°•, 50% ì´ìƒ: ë…¸ë‘, ê·¸ ì™¸: ì´ˆë¡)
                const pctClass = t.percentage >= 80 ? 'bg-danger' : (t.percentage >= 50 ? 'bg-warning' : 'bg-success');
                html += `<tr>
                    <td>${t.node}</td>
                    <td>${t.used}</td>
                    <td>${t.capacity}</td>
                    <td><span class="badge ${pctClass}">${t.percentage}%</span></td>
                </tr>`;
            });
            html += `</tbody></table>`;
            
            document.getElementById('capacity-content').innerHTML = html;
        }

        /**
         * Topology Viewer ë°ì´í„° ë Œë”ë§
         * @param {Object} data - topology API ì‘ë‹µ ë°ì´í„°
         * 
         * Controller -> Spine -> Leaf ìˆœìœ¼ë¡œ ë ˆì´ì–´ í‘œì‹œ
         * ê° ë…¸ë“œëŠ” ë°•ìŠ¤ í˜•íƒœë¡œ ì‹œê°í™”
         */
        function renderTopology(data) {
            // í† í´ë¡œì§€ ì»¨í…Œì´ë„ˆ ì‹œì‘
            let html = `
                <div class="topology-container">
                    <!-- ìƒë‹¨ ìš”ì•½ Badge -->
                    <div class="text-center mb-4">
                        <span class="badge controller-node me-2">Controllers: ${data.summary.controllers}</span>
                        <span class="badge spine-node me-2">Spines: ${data.summary.spines}</span>
                        <span class="badge leaf-node">Leafs: ${data.summary.leafs}</span>
                    </div>
                    
                    <!-- Controller ë ˆì´ì–´ -->
                    <div class="layer-label">ğŸ›ï¸ CONTROLLER LAYER</div>
                    <div class="spine-layer">
            `;
            
            // Controller ë…¸ë“œ ë°•ìŠ¤ ìƒì„±
            data.controllers.forEach(c => {
                // ìƒíƒœì— ë”°ë¼ í…Œë‘ë¦¬ ìƒ‰ìƒ ê²°ì •
                const statusClass = c.status === 'UP' ? 'node-status-up' : 'node-status-down';
                html += `<div class="node-box controller-node ${statusClass}">${c.name}<br><small>ID: ${c.id}</small></div>`;
            });
            
            html += `
                    </div>
                    
                    <!-- Controller-Spine ì—°ê²°ì„  -->
                    <div class="topology-line"></div>
                    
                    <!-- Spine ë ˆì´ì–´ -->
                    <div class="layer-label">ğŸ”· SPINE LAYER</div>
                    <div class="spine-layer">
            `;
            
            // Spine ë…¸ë“œ ë°•ìŠ¤ ìƒì„±
            data.spines.forEach(s => {
                const statusClass = s.status === 'UP' ? 'node-status-up' : 'node-status-down';
                html += `<div class="node-box spine-node ${statusClass}">${s.name}<br><small>${s.model.substring(0, 12)}</small></div>`;
            });
            
            html += `
                    </div>
                    
                    <!-- Spine-Leaf ì—°ê²°ì„  -->
                    <div class="topology-line"></div>
                    
                    <!-- Leaf ë ˆì´ì–´ -->
                    <div class="layer-label">ğŸŸ¢ LEAF LAYER</div>
                    <div class="leaf-layer">
            `;
            
            // Leaf ë…¸ë“œ ë°•ìŠ¤ ìƒì„±
            data.leafs.forEach(l => {
                const statusClass = l.status === 'UP' ? 'node-status-up' : 'node-status-down';
                html += `<div class="node-box leaf-node ${statusClass}">${l.name}<br><small>ID: ${l.id}</small></div>`;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            document.getElementById('topology-content').innerHTML = html;
        }

        /**
         * í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° ë¡œë“œ
         */
        window.onload = loadAll;
    </script>
</body>
</html>